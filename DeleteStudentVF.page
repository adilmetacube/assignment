<apex:page standardController="Student__c" recordSetVar="student" extensions="StudentControllerExtension" >
    <script src="/soap/ajax/20.0/connection.js" type="text/javascript"></script>
       <script> 
         var studentArray = []; 
    	</script> 

    <apex:repeat value="{!students}" var="student"> 
        <script> 
            studentArray.push('{!student}'); 
        </script> 
    </apex:repeat>  
    <script>   
        console.log('{!students}');
    
    function deleteStudents(){
        sforce.connection.sessionId = "{!$Api.Session_ID}";
        var errors = [];
        alert(' studentArray'+studentArray);
        var result = sforce.connection.deleteIds(studentArray);
        if (result && result.length)
        {
            var numFailed = 0;
            var numSucceeded = 0;
            for (var i = 0; i < result.length; i++)
            {
                var res = result[i];
                if (res && res.success == 'true')
                {
                    numSucceeded++;
                } 
                else 
                {
                    var es = res.getArray("errors");
                    if (es.length > 0) 
                    {
                        errors.push(es[0].message);
                    }
                    numFailed++;
                }
            }
            if (numFailed > 0)
            {
                alert("Failed: " + numFailed + "\nSucceeded: " + numSucceeded + " \n Due to: " + errors.join("\n"));
            } 
            else 
            {
                alert("Number of records deleted: " + numSucceeded);
                  CallListViewMethod();
            }
         
        }
    }
    function getRemoteStudentDel() {	
        
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.StudentControllerExtension.deleteStudentsRemotely}',
            records, 
            function(result, event){
                console.log('event.status',event.status);
                if (event.status) {
                    console.log('deleted successfully');
                } else if (event.type === 'exception') {
                    console.log('exception');
                } else {
                    
                }
            }, 
            {escape: true}
        );
    }	
    </script>
   
     <apex:pageMessages id="showmsg"></apex:pageMessages>
    <apex:form >
         <apex:actionFunction name="CallListViewMethod" action="{!listView}"  onComplete="alert('After apex method') ;" />
            <apex:commandButton action="{!listView}" value="Cancel" />
        <br/>
        <apex:outputPanel rendered="{!showStatus}">
        <apex:commandButton onClick="deleteStudents()" value="Continue" />
        <br/>

        <br/>
        <apex:commandButton onClick="getRemoteStudentDel()" value="Delete Remotely" />
        </apex:outputPanel>
    </apex:form>
</apex:page>
